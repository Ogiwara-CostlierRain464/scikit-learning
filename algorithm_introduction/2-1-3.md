# About
練習問題2-1-3:
Linear search(順次探索)の擬似コードを書き、そのアルゴリズムの正当性を証明せよ。

の回答

# 各用語の明記
回答の前に、まずは各用語を自分の言葉でしっかりとまとめておく。

正当: すべてのインスタンスに対して常に停止し、
その出力が正しいときアルゴリズムは正当である(correctness of an algorithm)という。

アルゴリズムの正当性を容易に理解するためにループ不変式を利用する。このとき、ループ不変式に
対して三つの性質を示す必要がある。

- 初期条件: ループの実行開始直前では、ループ不変式は真
- ループ内条件: ループの何回目かの繰り返しの直前でループ不変式が真 => 次の繰り返しの直前でも真
- 終了条件: ループが停止した時、アルゴリズムの正当性の証明に繋がる有力な性質がループ不変式から得られる

ここで、「ループの実行開始直前」「繰り返しの直前」というのを明確化しておく。

次のような疑似コードは

```python
for i in range(1, 4): # for i = 1 to 3
    print(i)
```

次のように展開できる

```python
# for文内のコンテキストに入る
i = 1
print(i)
i = 2
print(i)
i = 3
print(i)

i = 4 # 疑似コードにおいては、for文の条件式が偽になる事を確認してからfor文のコンテキストから抜ける
# for文内のコンテキストから抜ける
```

ここで、「繰り返しの直前」という部分的をコメントとして挿入する

```python
# begin 1回目
i = 1
# 1回目の繰り返しの直前
print(i)
# end 1回目

# begin 2回目
i = 2
# 2回目の繰り返しの直前
print(i)
# end 2回目
...
```

再び、for文で「繰り返しの直前」を明記する

```python
for i in range(1, 4):
    # i回目の繰り返しの直前
    print(i)
```

ここで、「1回目の繰り返しの直前」が「ループの実行開始直前」であると言える。

# 2-1-3の回答
```python
def linear_search(a, v):
    for j in range(1, a.length + 1):
        if a[j] == v:
            return j

    return None
```

このコードのループ不変式は、以下の命題である

`j回目のループ実行開始直前には、a[1..j-1]にはvは無い`

このループ不変式が必要とされる3つの性質を満たすことを確認する。

## 初期条件
「ループの実行開始直前では、ループ不変式は真」を示す。

- 「ループの実行開始直前」には`j=1`となる。
- ループ不変式は`1回目のループ実行開始直前には、a[1..1-1]にはvは無い`になる
- `a[1..0]`は空なので、自明にvは無い

## ループ内条件
「ループの何回目かの繰り返しの直前でループ不変式が真 => 次の繰り返しの直前でも真」を示す。

- 「ループのj回目の繰り返しの直前でループ不変式が真」と仮定する。
- `j回目のループ実行開始直前には、a[1..j-1]にはvは無い`が導出される
- `a[j]`について場合分け
- - `a[j]`がvならば、アルゴリズムはjを出力して終了するから、次の繰り返しは実行されない
- - `a[j]`がvでないならば、次の繰り返し(j+1回目の繰り返し)は実行される。この時、`j+1回目のループ実行開始直前には、a[1..j]にはvは無い`が導出できる。この時、題意が示された。

### Note
早期returnが存在するので、「次の繰り返しは実行されない」という事態が発生することに注意する。
次の繰り返しは実行されるケースにおいて「次の繰り返しの直前でも真」を示せばよい。

## 終了条件
「ループが停止した時、アルゴリズムの正当性の証明に繋がる有力な性質がループ不変式から得られる」を示す。
「すべてのインスタンスに対して常に停止し、その出力が正しい」を導出すればよい。

- `a.length+1`回目の繰り返しの時、for文の条件式(j = 1 to A.length)が偽になるので、`a.length`回目の繰り返しでループは終了する。これで、「すべてのインスタンスに対して常に停止する」が示せた。
- `a.length回目のループ実行開始直前には、a[1..a.length-1]にはvは無い`が導出される
- `a.length回目のループ実行開始直前には、配列aにはvは無い`が導出される
- `配列aにはvは無い`が導出される
- コードはループ終了後、NILを出力する。これで、「その出力が正しい」が示せた。